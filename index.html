<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام جامع العافية - إدارة حفظ القرآن الكريم</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #1a5f7a;
            --secondary-color: #57c5b6;
            --accent-color: #159895;
            --light-color: #f9f9f9;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --border-radius: 8px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --gold-color: #FFD700;
            --silver-color: #C0C0C0;
            --bronze-color: #CD7F32;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            margin: 0;
            padding: 0;
            color: var(--dark-color);
            min-height: 100vh;
            line-height: 1.6;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f5f7fa"/><path d="M0 50 Q 25 30, 50 50 T 100 50 L 100 100 L 0 100 Z" fill="%23e4e8f0"/></svg>');
            background-size: 100px 100px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 20px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
            border-bottom: 5px solid #0d4b63;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,128L48,117.3C96,107,192,85,288,101.3C384,117,480,171,576,170.7C672,171,768,117,864,101.3C960,85,1056,107,1152,133.3C1248,160,1344,192,1392,208L1440,224L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            opacity: 0.2;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .header h1 {
            margin: 0;
            padding: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-size: 2.5rem;
            letter-spacing: -0.5px;
        }
        
        .header p {
            font-size: 1.2rem;
            margin: 10px 0 0;
            opacity: 0.9;
            max-width: 800px;
            margin: 15px auto;
            line-height: 1.8;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            flex-wrap: wrap;
            border: 1px solid #eaeaea;
        }
        
        .tab {
            padding: 18px 30px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            flex-grow: 1;
            text-align: center;
            font-size: 1.1rem;
            position: relative;
            overflow: hidden;
        }
        
        .tab:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .tab.active {
            background-color: rgba(21, 152, 149, 0.1);
            color: var(--primary-color);
            border-bottom: 3px solid var(--accent-color);
            font-weight: 700;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
            border: 1px solid #f0f0f0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        h2 {
            color: var(--primary-color);
            margin-top: 0;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            font-size: 1.8rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h2 i {
            color: var(--accent-color);
        }
        
        h3 {
            color: var(--primary-color);
            margin-top: 20px;
            font-size: 1.4rem;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.05rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: 'Tajawal', sans-serif;
            font-size: 1.05rem;
            transition: all 0.3s ease;
            background: #fdfdfd;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(21, 152, 149, 0.2);
            background: #fff;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }
        
        button {
            padding: 14px 28px;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Tajawal', sans-serif;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        button i {
            font-size: 1.1rem;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--accent-color), var(--primary-color));
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, var(--primary-color), #0d4b63);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #f1f1f1, #e1e1e1);
            color: var(--dark-color);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(to right, #e1e1e1, #d1d1d1);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--danger-color), #c0392b);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(to right, #c0392b, #a93226);
            transform: translateY(-2px);
        }
        
        .search-container {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            border: 1px solid #f0f0f0;
        }
        
        .search-box {
            display: flex;
            gap: 15px;
        }
        
        .search-box input {
            flex: 1;
            padding: 14px 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid #eaeaea;
        }
        
        th, td {
            padding: 16px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: linear-gradient(to bottom, var(--primary-color), #0d4b63);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f1f1;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 14px;
            font-size: 0.95rem;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .edit-btn {
            background: linear-gradient(to right, var(--warning-color), #e67e22);
            color: white;
        }
        
        .delete-btn {
            background: linear-gradient(to right, var(--danger-color), #c0392b);
            color: white;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .status-excellent {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }
        
        .status-very-good {
            background-color: rgba(41, 128, 185, 0.2);
            color: #2980b9;
        }
        
        .status-good {
            background-color: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
        }
        
        .status-active {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }
        
        .status-inactive {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #777;
            font-size: 1.1rem;
        }
        
        .empty-state i {
            font-size: 3.5rem;
            color: #ddd;
            margin-bottom: 20px;
            opacity: 0.7;
        }
        
        .logout-btn {
            position: absolute;
            top: 25px;
            left: 25px;
            background: linear-gradient(to right, var(--danger-color), #c0392b);
            color: white;
            padding: 10px 18px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .user-info {
            position: absolute;
            top: 25px;
            right: 25px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 18px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.3);
            z-index: 10;
        }
        
        .export-options {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            background: linear-gradient(to right, #6c757d, #5a6268);
            color: white;
        }
        
        .export-btn:hover {
            background: linear-gradient(to right, #5a6268, #495057);
            transform: translateY(-2px);
        }
        
        .student-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-right: 5px solid var(--accent-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .settings-section {
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid #eee;
        }
        
        .motivation-message {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            padding: 25px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            border-right: 5px solid var(--accent-color);
            text-align: center;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            font-size: 1.05rem;
        }
        
        .alert-success {
            background-color: rgba(46, 204, 113, 0.2);
            border-right: 4px solid var(--success-color);
            color: var(--success-color);
        }
        
        .alert-error {
            background-color: rgba(231, 76, 60, 0.2);
            border-right: 4px solid var(--danger-color);
            color: var(--danger-color);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            text-align: center;
            transition: transform 0.3s ease;
            border: 1px solid #f0f0f0;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.8rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .stat-title {
            font-size: 1.2rem;
            color: var(--dark-color);
            font-weight: 500;
        }
        
        .progress-bar {
            height: 25px;
            background-color: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--accent-color), var(--primary-color));
            border-radius: 12px;
            text-align: center;
            color: white;
            font-size: 0.9rem;
            line-height: 25px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .supervisor-section {
            border: 2px solid #1a5f7a;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            background: linear-gradient(to right, #f8f9fa, #f0f5f7);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }
        
        .page-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            background: white;
            transition: all 0.3s ease;
        }
        
        .page-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(26, 95, 122, 0.3);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin: 30px 0;
            height: 400px;
            position: relative;
        }
        
        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(to right, var(--accent-color), var(--primary-color));
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .floating-btn:hover {
            transform: translateY(-5px) scale(1.1);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            transition: all 0.3s ease;
            border: 1px solid #f0f0f0;
            text-align: center;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .dashboard-card h3 {
            margin-top: 0;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .dashboard-card .icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .followup-history {
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            background: #fdfdfd;
        }
        
        .followup-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s ease;
        }
        
        .followup-item:hover {
            background: #f9f9f9;
        }
        
        .followup-item:last-child {
            border-bottom: none;
        }
        
        .groups-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .group-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            padding: 15px;
            background: #fdfdfd;
        }
        
        .group-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .group-item:hover {
            background: #f5f5f5;
        }
        
        .group-item:last-child {
            border-bottom: none;
        }
        
        .group-actions {
            display: flex;
            gap: 8px;
        }
        
        .medal {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-left: 5px;
        }
        
        .gold {
            background-color: var(--gold-color);
            color: #000;
        }
        
        .silver {
            background-color: var(--silver-color);
            color: #000;
        }
        
        .bronze {
            background-color: var(--bronze-color);
            color: #fff;
        }
        
        .evaluation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .evaluation-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            border-left: 5px solid var(--accent-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        
        .evaluation-card:hover {
            transform: translateY(-3px);
        }
        
        .login-container {
            max-width: 550px;
            margin: 60px auto;
            padding: 35px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid #f0f0f0;
        }
        
        .login-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 35px;
        }
        
        .login-header h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 2.2rem;
        }
        
        .login-type-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .login-type {
            flex: 1;
            padding: 20px;
            border: 2px solid #eee;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fdfdfd;
        }
        
        .login-type:hover {
            border-color: #ddd;
        }
        
        .login-type.active {
            border-color: var(--accent-color);
            background-color: rgba(21, 152, 149, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .login-type i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .login-fields {
            margin-bottom: 25px;
        }
        
        .login-actions {
            display: flex;
            justify-content: center;
            margin-top: 35px;
        }
        
        .login-device {
            text-align: center;
            margin-top: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            color: #777;
            font-size: 0.95rem;
            border: 1px solid #eee;
        }
        
        .owner-section {
            border: 2px solid #8e44ad;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            background: linear-gradient(to right, #f5eef8, #f0e5f5);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .admin-section {
            border: 2px solid #1a5f7a;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            background: linear-gradient(to right, #f8f9fa, #f0f5f7);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        @media (max-width: 992px) {
            .groups-management {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .tab {
                padding: 15px;
                font-size: 1rem;
            }
            
            th, td {
                padding: 12px;
                font-size: 0.95rem;
            }
            
            .actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .logout-btn, .user-info {
                position: static;
                margin: 15px 0;
                display: block;
                width: 100%;
                text-align: center;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-value {
                font-size: 2.3rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- واجهة تسجيل الدخول -->
    <div class="container" id="auth-container">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-book-quran"></i> نظام جامع العافية</h1>
                <p>نظام متكامل لمتابعة حفظ القرآن الكريم وتقييم الطلاب</p>
            </div>
            
            <div class="alert" id="login-message"></div>
            
            <div class="login-type-selector">
                <div class="login-type active" id="admin-type" onclick="selectLoginType('admin')">
                    <i class="fas fa-user-tie"></i>
                    <div>مشرف</div>
                </div>
                <div class="login-type" id="owner-type" onclick="selectLoginType('owner')">
                    <i class="fas fa-user-shield"></i>
                    <div>مالك</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="username"><i class="fas fa-user"></i> اسم المستخدم:</label>
                <input type="text" id="username" placeholder="أدخل اسم المستخدم">
            </div>
            
            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> كلمة المرور:</label>
                <input type="password" id="password" placeholder="أدخل كلمة المرور">
            </div>
            
            <div class="login-actions">
                <button class="btn-primary" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> تسجيل الدخول
                </button>
            </div>
            
            <div class="login-device">
                <i class="fas fa-info-circle"></i> يمكنك تسجيل الدخول من أي جهاز متصل بالإنترنت
            </div>
        </div>
    </div>

    <!-- الواجهة الرئيسية للنظام -->
    <div class="container" id="app-container" style="display: none;">
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
        </button>
        
        <div class="user-info" id="user-info">
            <i class="fas fa-user"></i> <span id="username-display">المشرف: أحمد محمد</span>
        </div>
        
        <div class="header">
            <div class="header-content">
                <h1>نظام جامع العافية المتكامل</h1>
                <p>نظام متابعة حفظ القرآن الكريم وتقييم الطلاب مع تقارير متقدمة وإدارة كاملة</p>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="openTab('dashboard')">لوحة التحكم</div>
            <div class="tab" onclick="openTab('students')">إدارة الطلاب</div>
            <div class="tab" onclick="openTab('followup')">المتابعة اليومية</div>
            <div class="tab" onclick="openTab('groups')">إدارة المجموعات</div>
            <div class="tab" onclick="openTab('reports')">التقارير والإحصائيات</div>
            <div class="tab" onclick="openTab('settings')">الإعدادات</div>
        </div>
        
        <!-- لوحة التحكم -->
        <div id="dashboard" class="tab-content active">
            <div class="motivation-message">
                <i class="fas fa-star"></i> خيركم من تعلم القرآن وعلمه
                <i class="fas fa-star"></i>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-students">0</div>
                    <div class="stat-title">عدد الطلاب</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="excellent-students">0</div>
                    <div class="stat-title">طلاب ممتازين</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="verygood-students">0</div>
                    <div class="stat-title">طلاب جيد جداً</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="needs-attention">0</div>
                    <div class="stat-title">طلاب بحاجة متابعة</div>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h3>أحدث المتابعات</h3>
                    <div class="followup-history" id="recent-followups">
                        <!-- سيتم تعبئته بالجافاسكريبت -->
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h3>أفضل الطلاب</h3>
                    <div id="top-students">
                        <!-- سيتم تعبئته بالجافاسكريبت -->
                    </div>
                </div>
            </div>
            
            <h2><i class="fas fa-chart-line"></i> تقدم الحفظ الشهري</h2>
            <div class="chart-container">
                <canvas id="progress-chart"></canvas>
            </div>
        </div>
        
        <!-- إدارة الطلاب -->
        <div id="students" class="tab-content">
            <h2><i class="fas fa-users"></i> إدارة الطلاب</h2>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="student-search" placeholder="ابحث عن طالب..." oninput="searchStudents()">
                    <button class="btn-primary" onclick="searchStudents()"><i class="fas fa-search"></i> بحث</button>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn-primary" onclick="showAddStudentForm()">
                    <i class="fas fa-user-plus"></i> إضافة طالب جديد
                </button>
                <button class="btn-secondary" onclick="refreshStudents()">
                    <i class="fas fa-sync-alt"></i> تحديث البيانات
                </button>
            </div>
            
            <div class="admin-section" id="add-student-form" style="display: none;">
                <h3>إضافة طالب جديد</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="student-name">اسم الطالب الكامل:</label>
                        <input type="text" id="student-name" placeholder="أدخل الاسم الكامل">
                    </div>
                    <div class="form-group">
                        <label for="student-age">العمر:</label>
                        <input type="number" id="student-age" placeholder="أدخل العمر">
                    </div>
                    <div class="form-group">
                        <label for="student-phone">رقم الهاتف:</label>
                        <input type="tel" id="student-phone" placeholder="أدخل رقم الهاتف">
                    </div>
                    <div class="form-group">
                        <label for="student-group">المجموعة:</label>
                        <select id="student-group">
                            <option value="">اختر مجموعة</option>
                            <!-- سيتم تعبئته بالجافاسكريبت -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="student-start">تاريخ البدء:</label>
                        <input type="date" id="student-start">
                    </div>
                    <div class="form-group">
                        <label for="student-notes">ملاحظات:</label>
                        <textarea id="student-notes" rows="3" placeholder="أي ملاحظات إضافية"></textarea>
                    </div>
                </div>
                <div class="buttons">
                    <button class="btn-secondary" onclick="hideAddStudentForm()">إلغاء</button>
                    <button class="btn-primary" onclick="addStudent()">حفظ الطالب</button>
                </div>
            </div>
            
            <div class="admin-section">
                <h3>قائمة الطلاب</h3>
                <div class="alert alert-success" id="students-message" style="display: none;"></div>
                <table>
                    <thead>
                        <tr>
                            <th>اسم الطالب</th>
                            <th>العمر</th>
                            <th>المجموعة</th>
                            <th>التقييم</th>
                            <th>الحفظ الحالي</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="students-table-body">
                        <!-- سيتم تعبئته بالجافاسكريبت -->
                    </tbody>
                </table>
                
                <div class="pagination" id="students-pagination">
                    <!-- سيتم تعبئته بالجافاسكريبت -->
                </div>
            </div>
        </div>
        
        <!-- المتابعة اليومية -->
        <div id="followup" class="tab-content">
            <h2><i class="fas fa-book-open"></i> المتابعة اليومية</h2>
            
            <div class="alert alert-success">
                <i class="fas fa-info-circle"></i> يرجى تسجيل متابعة الطلاب بعد كل حصة
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="followup-date">التاريخ:</label>
                    <input type="date" id="followup-date" value="">
                </div>
                <div class="form-group">
                    <label for="followup-group">المجموعة:</label>
                    <select id="followup-group">
                        <option value="">اختر مجموعة</option>
                        <!-- سيتم تعبئته بالجافاسكريبت -->
                    </select>
                </div>
            </div>
            
            <h3>تسجيل المتابعة</h3>
            <div class="followup-container">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="followup-student">الطالب:</label>
                        <select id="followup-student">
                            <option value="">اختر طالب</option>
                            <!-- سيتم تعبئته بالجافاسكريبت -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="followup-part">الجزء:</label>
                        <select id="followup-part">
                            <option value="">اختر جزء</option>
                            <!-- سيتم تعبئته بالجافاسكريبت -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="followup-pages">الصفحات:</label>
                        <input type="text" id="followup-pages" placeholder="مثال: 5-10">
                    </div>
                    <div class="form-group">
                        <label for="followup-evaluation">التقييم:</label>
                        <select id="followup-evaluation">
                            <option value="">اختر تقييم</option>
                            <option value="excellent">ممتاز</option>
                            <option value="very-good">جيد جداً</option>
                            <option value="good">جيد</option>
                            <option value="weak">ضعيف</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="followup-notes">ملاحظات:</label>
                    <textarea id="followup-notes" rows="4" placeholder="ملاحظات حول الحفظ والأداء"></textarea>
                </div>
                
                <div class="buttons">
                    <button class="btn-primary" onclick="saveFollowup()">
                        <i class="fas fa-save"></i> حفظ المتابعة
                    </button>
                    <button class="btn-secondary" onclick="clearFollowupForm()">
                        <i class="fas fa-times"></i> مسح النموذج
                    </button>
                </div>
            </div>
            
            <h3>سجل المتابعات</h3>
            <div class="followup-container">
                <div class="followup-history" id="followups-history">
                    <!-- سيتم تعبئته بالجافاسكريبت -->
                </div>
            </div>
        </div>
        
        <!-- إدارة المجموعات -->
        <div id="groups" class="tab-content">
            <h2><i class="fas fa-object-group"></i> إدارة المجموعات</h2>
            
            <div class="admin-section">
                <div class="groups-management">
                    <div>
                        <div class="form-group">
                            <label for="group-name">اسم المجموعة:</label>
                            <input type="text" id="group-name" placeholder="أدخل اسم المجموعة">
                        </div>
                        
                        <div class="form-group">
                            <label for="group-description">وصف المجموعة:</label>
                            <textarea id="group-description" rows="4" placeholder="وصف المجموعة وأهدافها"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="group-supervisor">المشرف المسؤول:</label>
                            <select id="group-supervisor">
                                <option value="">اختر مشرف</option>
                                <!-- سيتم تعبئته بالجافاسكريبت -->
                            </select>
                        </div>
                        
                        <div class="buttons">
                            <button class="btn-primary" onclick="addGroup()">إضافة مجموعة</button>
                        </div>
                    </div>
                    
                    <div>
                        <h3>المجموعات الحالية</h3>
                        <div class="group-list" id="groups-list">
                            <!-- سيتم تعبئته بالجافاسكريبت -->
                        </div>
                    </div>
                </div>
            </div>
            
            <h3>ربط الطلاب بالمجموعات</h3>
            <div class="admin-section">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="assign-student">الطالب:</label>
                        <select id="assign-student">
                            <option value="">اختر طالب</option>
                            <!-- سيتم تعبئته بالجافاسكريبت -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assign-group">المجموعة:</label>
                        <select id="assign-group">
                            <option value="">اختر مجموعة</option>
                            <!-- سيتم تعبئته بالجافاسكريبت -->
                        </select>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn-primary" onclick="assignStudentToGroup()">
                        <i class="fas fa-link"></i> ربط الطالب بالمجموعة
                    </button>
                </div>
            </div>
        </div>
        
        <!-- التقارير والإحصائيات -->
        <div id="reports" class="tab-content">
            <h2><i class="fas fa-chart-pie"></i> التقارير والإحصائيات</h2>
            
            <div class="export-options">
                <button class="btn-primary export-btn" onclick="exportToPDF()">
                    <i class="fas fa-file-pdf"></i> تصدير PDF
                </button>
                <button class="btn-primary export-btn" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> تصدير Excel
                </button>
                <button class="btn-primary export-btn" onclick="printReport()">
                    <i class="fas fa-print"></i> طباعة
                </button>
            </div>
            
            <div class="supervisor-section">
                <h3>تقارير الطلاب</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="report-student">الطالب:</label>
                        <select id="report-student">
                            <option value="">جميع الطلاب</option>
                            <!-- سيتم تعبئته بالجافاسكريبت -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-group">المجموعة:</label>
                        <select id="report-group">
                            <option value="">جميع المجموعات</option>
                            <!-- سيتم تعبئته بالجافاسكريبت -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-evaluation">التقييم:</label>
                        <select id="report-evaluation">
                            <option value="">جميع التقييمات</option>
                            <option value="excellent">ممتاز</option>
                            <option value="very-good">جيد جداً</option>
                            <option value="good">جيد</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-date">الفترة:</label>
                        <input type="month" id="report-date" value="">
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn-primary" onclick="generateReport()">
                        <i class="fas fa-chart-bar"></i> توليد التقرير
                    </button>
                </div>
            </div>
            
            <div class="supervisor-section">
                <h3>إحصائيات الأداء</h3>
                <div class="chart-container">
                    <canvas id="performance-chart"></canvas>
                </div>
            </div>
            
            <div class="supervisor-section">
                <h3>تقرير الحفظ الشامل</h3>
                <div class="evaluation-grid" id="progress-grid">
                    <!-- سيتم تعبئته بالجافاسكريبت -->
                </div>
            </div>
        </div>
        
        <!-- الإعدادات -->
        <div id="settings" class="tab-content">
            <h2><i class="fas fa-cog"></i> الإعدادات</h2>
            
            <div class="owner-section" id="admin-management">
                <h3><i class="fas fa-users"></i> إدارة المشرفين</h3>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="new-admin-name">اسم المشرف الجديد:</label>
                        <input type="text" id="new-admin-name" placeholder="أدخل الاسم الكامل">
                    </div>
                    <div class="form-group">
                        <label for="new-admin-email">البريد الإلكتروني:</label>
                        <input type="email" id="new-admin-email" placeholder="أدخل البريد الإلكتروني">
                    </div>
                    <div class="form-group">
                        <label for="new-admin-password">كلمة المرور:</label>
                        <input type="password" id="new-admin-password" placeholder="أدخل كلمة المرور">
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn-primary" onclick="addAdmin()">
                        <i class="fas fa-user-plus"></i> إضافة مشرف جديد
                    </button>
                </div>
                
                <h4>قائمة المشرفين</h4>
                <table>
                    <thead>
                        <tr>
                            <th>اسم المشرف</th>
                            <th>البريد الإلكتروني</th>
                            <th>تاريخ التسجيل</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="admins-table-body">
                        <!-- سيتم تعبئته بالجافاسكريبت -->
                    </tbody>
                </table>
            </div>
            
            <div class="admin-section">
                <h3><i class="fas fa-star"></i> إعدادات التقييم</h3>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="eval-excellent">الممتاز:</label>
                        <input type="number" id="eval-excellent" min="90" max="100" value="95">
                        <div class="detail-item">من 95% إلى 100%</div>
                    </div>
                    <div class="form-group">
                        <label for="eval-very-good">جيد جداً:</label>
                        <input type="number" id="eval-very-good" min="80" max="94" value="85">
                        <div class="detail-item">من 85% إلى 94%</div>
                    </div>
                    <div class="form-group">
                        <label for="eval-good">جيد:</label>
                        <input type="number" id="eval-good" min="70" max="84" value="75">
                        <div class="detail-item">من 75% إلى 84%</div>
                    </div>
                    <div class="form-group">
                        <label for="eval-weak">ضعيف:</label>
                        <input type="number" id="eval-weak" min="0" max="74" value="0">
                        <div class="detail-item">أقل من 75%</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn-primary" onclick="saveEvaluationSettings()">حفظ الإعدادات</button>
                </div>
            </div>
            
            <div class="admin-section">
                <h3><i class="fas fa-database"></i> نسخ احتياطي</h3>
                <p>قم بعمل نسخة احتياطية من قاعدة البيانات لاسترجاعها لاحقاً</p>
                <div class="buttons">
                    <button class="btn-primary" onclick="backupDatabase()">
                        <i class="fas fa-download"></i> نسخ احتياطي
                    </button>
                    <button class="btn-secondary" onclick="restoreDatabase()">
                        <i class="fas fa-upload"></i> استعادة نسخة
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="floating-btn" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
        // ===== بيانات النظام =====
        const quranParts = [
            "الفاتحة والبقرة", "آل عمران", "النساء", "المائدة", "الأنعام", 
            "الأعراف", "الأنفال والتوبة", "يونس وهود", "يوسف", "الرعد وإبراهيم والحجر", 
            "النحل والإسراء", "الكهف ومريم", "طه والأنبياء", "الحج والمؤمنون", "النور والفرقان", 
            "الشعراء والنمل", "القصص والعنكبوت", "الروم ولقمان والسجدة", "الأحزاب وسبأ وفاطر", "يس والصافات", 
            "ص والزمر", "غافر وفصلت", "الشورى والزخرف والدخان", "الجاثية والأحقاف ومحمد", "الفتح والحجرات وق والذاريات", 
            "الطور والنجم والقمر والرحمن", "الواقعة والحديد والمجادلة", "الحشر والممتحنة والصف والجمعة والمنافقون", 
            "التغابن والطلاق والتحريم والملك", "نوح والجن والمزمل والمدثر والقيامة"
        ];
        
        let students = [
            { id: 1, name: "عمر أحمد", age: 15, groupId: 1, group: "المجموعة الأولى", evaluation: "excellent", current: "الجزء 28", startDate: "2023-01-10", phone: "0551234567", notes: "طالب مجتهد" },
            { id: 2, name: "محمد خالد", age: 14, groupId: 2, group: "المجموعة الثانية", evaluation: "very-good", current: "الجزء 15", startDate: "2023-02-15", phone: "0557654321", notes: "يحتاج متابعة" },
            { id: 3, name: "سارة عبدالله", age: 16, groupId: 1, group: "المجموعة الأولى", evaluation: "excellent", current: "الجزء 30", startDate: "2023-03-01", phone: "0551122334", notes: "متميزة في الحفظ" }
        ];
        
        let groups = [
            { id: 1, name: "المجموعة الأولى", description: "مجموعة متقدمة في الحفظ", supervisorId: 1, supervisor: "أحمد محمد" },
            { id: 2, name: "المجموعة الثانية", description: "مجموعة متوسطة في الحفظ", supervisorId: 2, supervisor: "سارة عبدالله" },
            { id: 3, name: "المجموعة الثالثة", description: "مجموعة مبتدئة في الحفظ", supervisorId: 3, supervisor: "محمد علي" }
        ];
        
        let admins = [
            { id: 1, name: "أحمد محمد", email: "ahmed@alafia.com", password: "admin123", joinDate: "2023-01-15" },
            { id: 2, name: "سارة عبدالله", email: "sara@alafia.com", password: "admin123", joinDate: "2023-03-22" },
            { id: 3, name: "محمد علي", email: "mohammed@alafia.com", password: "admin123", joinDate: "2023-05-10" }
        ];
        
        let followups = [
            { id: 1, studentId: 1, studentName: "عمر أحمد", part: "الجزء 28", pages: "1-3", evaluation: "excellent", date: "2023-10-05", notes: "الحفظ متقن والتلاوة جيدة جداً" },
            { id: 2, studentId: 2, studentName: "محمد خالد", part: "الجزء 15", pages: "4-6", evaluation: "very-good", date: "2023-10-05", notes: "يحتاج تحسين في مخارج الحروف" },
            { id: 3, studentId: 3, studentName: "سارة عبدالله", part: "الجزء 30", pages: "7-10", evaluation: "excellent", date: "2023-10-04", notes: "أداء ممتاز وحفظ متقن" }
        ];
        
        // ===== تهيئة النظام =====
        document.addEventListener('DOMContentLoaded', function() {
            // تعيين التاريخ الحالي لحقول التاريخ
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            document.getElementById('followup-date').value = today;
            document.getElementById('report-date').value = currentMonth;
            document.getElementById('student-start').value = today;
            
            // تحديث الواجهة
            updateUI();
        });
        
        // ===== وظائف تسجيل الدخول =====
        function selectLoginType(userType) {
            const adminType = document.getElementById('admin-type');
            const ownerType = document.getElementById('owner-type');
            
            if (userType === 'admin') {
                adminType.classList.add('active');
                ownerType.classList.remove('active');
            } else {
                ownerType.classList.add('active');
                adminType.classList.remove('active');
            }
        }
        
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const userType = document.querySelector('.login-type.active').id;
            const isOwner = userType === 'owner-type';
            
            // التحقق من صحة المستخدم
            if (isOwner && username === 'owner' && password === 'owner123') {
                showLoginMessage('تم تسجيل دخول المالك بنجاح', 'success');
                setTimeout(() => {
                    document.getElementById('auth-container').style.display = 'none';
                    document.getElementById('app-container').style.display = 'block';
                    document.getElementById('username-display').textContent = `مالك النظام: مالك النظام`;
                    document.getElementById('admin-management').style.display = 'block';
                    updateUI();
                }, 1000);
            } 
            else if (!isOwner) {
                const admin = admins.find(a => a.name === username || a.email === username);
                if (admin && admin.password === password) {
                    showLoginMessage(`تم تسجيل دخول المشرف ${admin.name} بنجاح`, 'success');
                    setTimeout(() => {
                        document.getElementById('auth-container').style.display = 'none';
                        document.getElementById('app-container').style.display = 'block';
                        document.getElementById('username-display').textContent = `مشرف: ${admin.name}`;
                        document.getElementById('admin-management').style.display = 'none';
                        updateUI();
                    }, 1000);
                } else {
                    showLoginMessage('بيانات الدخول غير صحيحة! الرجاء المحاولة مرة أخرى', 'error');
                }
            } 
            else {
                showLoginMessage('بيانات الدخول غير صحيحة! الرجاء المحاولة مرة أخرى', 'error');
            }
        }
        
        function logout() {
            document.getElementById('auth-container').style.display = 'block';
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-message').textContent = '';
            document.getElementById('login-message').className = 'alert';
        }
        
        function showLoginMessage(message, type) {
            const messageDiv = document.getElementById('login-message');
            messageDiv.textContent = message;
            messageDiv.className = 'alert';
            messageDiv.classList.add(type === 'success' ? 'alert-success' : 'alert-error');
        }
        
        // ===== وظائف التبويبات =====
        function openTab(tabName) {
            // إخفاء جميع محتويات التبويبات
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // إزالة النشط من جميع التبويبات
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // إظهار التبويب المحدد
            document.getElementById(tabName).classList.add('active');
            
            // إضافة النشط للتبويب المحدد
            event.currentTarget.classList.add('active');
            
            // تحديث البيانات عند فتح التبويب
            if (tabName === 'students') renderStudentsTable();
            if (tabName === 'followup') renderFollowupsHistory();
            if (tabName === 'groups') renderGroupsList();
            if (tabName === 'reports') generateReport();
            if (tabName === 'settings') renderAdminsTable();
        }
        
        // ===== إدارة الطلاب =====
        function showAddStudentForm() {
            document.getElementById('add-student-form').style.display = 'block';
            populateGroupsDropdown('student-group');
        }
        
        function hideAddStudentForm() {
            document.getElementById('add-student-form').style.display = 'none';
        }
        
        function addStudent() {
            const name = document.getElementById('student-name').value;
            const age = document.getElementById('student-age').value;
            const phone = document.getElementById('student-phone').value;
            const groupId = document.getElementById('student-group').value;
            const startDate = document.getElementById('student-start').value;
            const notes = document.getElementById('student-notes').value;
            
            if (!name || !age || !groupId) {
                showMessage('students-message', 'الرجاء ملء جميع الحقول المطلوبة', 'error');
                return;
            }
            
            const group = groups.find(g => g.id == groupId);
            if (!group) return;
            
            const newStudent = {
                id: Date.now(),
                name,
                age,
                phone,
                groupId,
                group: group.name,
                evaluation: "good",
                current: "لم يبدأ بعد",
                startDate,
                notes
            };
            
            students.push(newStudent);
            renderStudentsTable();
            hideAddStudentForm();
            showMessage('students-message', `تم إضافة الطالب ${name} بنجاح`, 'success');
            updateStats();
        }
        
        function searchStudents() {
            const searchTerm = document.getElementById('student-search').value.toLowerCase();
            renderStudentsTable(searchTerm);
        }
        
        function refreshStudents() {
            renderStudentsTable();
        }
        
        function renderStudentsTable(searchTerm = '') {
            const tableBody = document.getElementById('students-table-body');
            tableBody.innerHTML = '';
            
            const filteredStudents = students.filter(student => 
                student.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                student.group.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredStudents.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-user-slash"></i>
                            <div>لا يوجد طلاب مسجلين</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredStudents.forEach(student => {
                let statusClass = '';
                if (student.evaluation === 'excellent') statusClass = 'status-excellent';
                if (student.evaluation === 'very-good') statusClass = 'status-very-good';
                if (student.evaluation === 'good') statusClass = 'status-good';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.name}</td>
                    <td>${student.age}</td>
                    <td>${student.group}</td>
                    <td><span class="status-badge ${statusClass}">${getEvaluationText(student.evaluation)}</span></td>
                    <td>${student.current}</td>
                    <td class="actions">
                        <button class="action-btn edit-btn" onclick="editStudent(${student.id})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteStudent(${student.id})"><i class="fas fa-trash"></i></button>
                        <button class="action-btn btn-primary" onclick="viewStudent(${student.id})"><i class="fas fa-eye"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (student) {
                // في تطبيق حقيقي سيتم فتح نموذج التعديل
                alert(`ستتم الآن تعديل بيانات الطالب: ${student.name}`);
            }
        }
        
        function deleteStudent(id) {
            if (confirm('هل أنت متأكد من رغبتك في حذف هذا الطالب؟')) {
                const index = students.findIndex(s => s.id === id);
                if (index !== -1) {
                    const name = students[index].name;
                    students.splice(index, 1);
                    renderStudentsTable();
                    showMessage('students-message', `تم حذف الطالب ${name} بنجاح`, 'success');
                    updateStats();
                }
            }
        }
        
        function viewStudent(id) {
            const student = students.find(s => s.id === id);
            if (student) {
                // في تطبيق حقيقي سيتم توجيه المستخدم لصفحة تفاصيل الطالب
                alert(`ستتم الآن معاينة بيانات الطالب: ${student.name}`);
            }
        }
        
        // ===== المتابعة اليومية =====
        function saveFollowup() {
            const studentId = document.getElementById('followup-student').value;
            const part = document.getElementById('followup-part').value;
            const pages = document.getElementById('followup-pages').value;
            const evaluation = document.getElementById('followup-evaluation').value;
            const notes = document.getElementById('followup-notes').value;
            const date = document.getElementById('followup-date').value || new Date().toISOString().split('T')[0];
            
            if (!studentId || !part || !pages || !evaluation) {
                alert('الرجاء ملء جميع الحقول المطلوبة');
                return;
            }
            
            const student = students.find(s => s.id == studentId);
            if (!student) return;
            
            const newFollowup = {
                id: Date.now(),
                studentId,
                studentName: student.name,
                part: quranParts[part - 1],
                pages,
                evaluation,
                date,
                notes
            };
            
            followups.push(newFollowup);
            renderFollowupsHistory();
            renderRecentFollowups();
            
            // إعادة تعيين النموذج
            clearFollowupForm();
            
            alert('تم حفظ المتابعة بنجاح');
        }
        
        function clearFollowupForm() {
            document.getElementById('followup-student').value = '';
            document.getElementById('followup-part').value = '';
            document.getElementById('followup-pages').value = '';
            document.getElementById('followup-evaluation').value = '';
            document.getElementById('followup-notes').value = '';
        }
        
        function renderFollowupsHistory() {
            const container = document.getElementById('followups-history');
            container.innerHTML = '';
            
            if (followups.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-clipboard-list"></i> لا توجد متابعات مسجلة</div>`;
                return;
            }
            
            followups.slice().reverse().forEach(followup => {
                let statusClass = '';
                if (followup.evaluation === 'excellent') statusClass = 'status-excellent';
                if (followup.evaluation === 'very-good') statusClass = 'status-very-good';
                if (followup.evaluation === 'good') statusClass = 'status-good';
                
                const item = document.createElement('div');
                item.className = 'followup-item';
                item.innerHTML = `
                    <strong>${followup.studentName}</strong> - ${followup.part} (الصفحات ${followup.pages}) 
                    <div>التقييم: <span class="status-badge ${statusClass}">${getEvaluationText(followup.evaluation)}</span></div>
                    <div>التاريخ: ${followup.date}</div>
                    <div>ملاحظات: ${followup.notes}</div>
                    <div class="actions" style="margin-top: 10px;">
                        <button class="action-btn edit-btn" onclick="editFollowup(${followup.id})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteFollowup(${followup.id})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function renderRecentFollowups() {
            const container = document.getElementById('recent-followups');
            container.innerHTML = '';
            
            const recent = followups.slice(-5).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-clipboard-list"></i> لا توجد متابعات حديثة</div>`;
                return;
            }
            
            recent.forEach(followup => {
                let statusClass = '';
                if (followup.evaluation === 'excellent') statusClass = 'status-excellent';
                if (followup.evaluation === 'very-good') statusClass = 'status-very-good';
                
                const item = document.createElement('div');
                item.className = 'followup-item';
                item.innerHTML = `
                    <strong>${followup.studentName}</strong> - ${followup.part} (الصفحات ${followup.pages}) - التقييم: <span class="${statusClass}">${getEvaluationText(followup.evaluation)}</span>
                    <div class="detail-item">التاريخ: ${followup.date}</div>
                `;
                container.appendChild(item);
            });
        }
        
        function editFollowup(id) {
            const followup = followups.find(f => f.id === id);
            if (followup) {
                alert(`ستتم الآن تعديل متابعة الطالب: ${followup.studentName}`);
            }
        }
        
        function deleteFollowup(id) {
            if (confirm('هل أنت متأكد من رغبتك في حذف هذه المتابعة؟')) {
                const index = followups.findIndex(f => f.id === id);
                if (index !== -1) {
                    followups.splice(index, 1);
                    renderFollowupsHistory();
                    renderRecentFollowups();
                }
            }
        }
        
        // ===== إدارة المجموعات =====
        function addGroup() {
            const name = document.getElementById('group-name').value;
            const description = document.getElementById('group-description').value;
            const supervisorId = document.getElementById('group-supervisor').value;
            
            if (!name || !supervisorId) {
                alert('الرجاء ملء جميع الحقول المطلوبة');
                return;
            }
            
            const supervisor = admins.find(a => a.id == supervisorId);
            if (!supervisor) return;
            
            const newGroup = {
                id: Date.now(),
                name,
                description,
                supervisorId,
                supervisor: supervisor.name
            };
            
            groups.push(newGroup);
            renderGroupsList();
            
            // إعادة تعيين النموذج
            document.getElementById('group-name').value = '';
            document.getElementById('group-description').value = '';
            document.getElementById('group-supervisor').value = '';
            
            alert('تم إضافة المجموعة بنجاح');
        }
        
        function renderGroupsList() {
            const container = document.getElementById('groups-list');
            container.innerHTML = '';
            
            if (groups.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-users-slash"></i> لا توجد مجموعات</div>`;
                return;
            }
            
            groups.forEach(group => {
                const item = document.createElement('div');
                item.className = 'group-item';
                item.innerHTML = `
                    <div>
                        <strong>${group.name}</strong>
                        <div>المشرف: ${group.supervisor}</div>
                        <div>${group.description}</div>
                    </div>
                    <div class="group-actions">
                        <button class="action-btn edit-btn" onclick="editGroup(${group.id})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteGroup(${group.id})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function assignStudentToGroup() {
            const studentId = document.getElementById('assign-student').value;
            const groupId = document.getElementById('assign-group').value;
            
            if (!studentId || !groupId) {
                alert('الرجاء اختيار طالب ومجموعة');
                return;
            }
            
            const student = students.find(s => s.id == studentId);
            const group = groups.find(g => g.id == groupId);
            
            if (student && group) {
                student.groupId = groupId;
                student.group = group.name;
                renderStudentsTable();
                alert(`تم ربط الطالب ${student.name} بمجموعة ${group.name} بنجاح`);
            }
        }
        
        function editGroup(id) {
            const group = groups.find(g => g.id === id);
            if (group) {
                alert(`ستتم الآن تعديل بيانات المجموعة: ${group.name}`);
            }
        }
        
        function deleteGroup(id) {
            if (confirm('هل أنت متأكد من رغبتك في حذف هذه المجموعة؟')) {
                const index = groups.findIndex(g => g.id === id);
                if (index !== -1) {
                    const name = groups[index].name;
                    groups.splice(index, 1);
                    renderGroupsList();
                    
                    // إزالة المجموعة من الطلاب
                    students.forEach(student => {
                        if (student.groupId == id) {
                            student.groupId = null;
                            student.group = "غير معين";
                        }
                    });
                    
                    alert(`تم حذف المجموعة ${name} بنجاح`);
                }
            }
        }
        
        // ===== التقارير والإحصائيات =====
        function generateReport() {
            const container = document.getElementById('report-results');
            container.innerHTML = 'جارٍ توليد التقرير...';
            
            setTimeout(() => {
                // هذه بيانات وهمية لأغراض العرض
                container.innerHTML = `
                    <h3>نتائج التقرير</h3>
                    <div class="evaluation-grid">
                        <div class="evaluation-card">
                            <h3>إجمالي الطلاب</h3>
                            <div class="stat-value">${students.length}</div>
                        </div>
                        <div class="evaluation-card">
                            <h3>متوسط الصفحات المحفوظة</h3>
                            <div class="stat-value">65</div>
                        </div>
                        <div class="evaluation-card">
                            <h3>أعلى تقييم</h3>
                            <div class="stat-value">${students.filter(s => s.evaluation === 'excellent').length}</div>
                            <div>طلاب ممتازين</div>
                        </div>
                        <div class="evaluation-card">
                            <h3>أقل تقييم</h3>
                            <div class="stat-value">${students.filter(s => s.evaluation === 'weak').length}</div>
                            <div>طلاب بحاجة متابعة</div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;">تقدم الحفظ حسب المجموعات</h3>
                    <div class="evaluation-grid">
                        <div class="evaluation-card">
                            <h3>المجموعة الأولى</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 78%">78%</div>
                            </div>
                        </div>
                        <div class="evaluation-card">
                            <h3>المجموعة الثانية</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%">65%</div>
                            </div>
                        </div>
                        <div class="evaluation-card">
                            <h3>المجموعة الثالثة</h3>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 52%">52%</div>
                            </div>
                        </div>
                    </div>
                `;
            }, 1000);
        }
        
        function exportToPDF() {
            alert('تم تصدير التقرير بصيغة PDF بنجاح');
        }
        
        function exportToExcel() {
            alert('تم تصدير التقرير بصيغة Excel بنجاح');
        }
        
        function printReport() {
            window.print();
        }
        
        // ===== الإعدادات =====
        function addAdmin() {
            const name = document.getElementById('new-admin-name').value;
            const email = document.getElementById('new-admin-email').value;
            const password = document.getElementById('new-admin-password').value;
            
            if (!name || !email || !password) {
                alert('الرجاء ملء جميع الحقول المطلوبة');
                return;
            }
            
            const newAdmin = {
                id: Date.now(),
                name,
                email,
                password,
                joinDate: new Date().toISOString().split('T')[0]
            };
            
            admins.push(newAdmin);
            renderAdminsTable();
            
            // إعادة تعيين النموذج
            document.getElementById('new-admin-name').value = '';
            document.getElementById('new-admin-email').value = '';
            document.getElementById('new-admin-password').value = '';
            
            alert('تم إضافة المشرف بنجاح');
        }
        
        function renderAdminsTable() {
            const tableBody = document.getElementById('admins-table-body');
            tableBody.innerHTML = '';
            
            if (admins.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <i class="fas fa-user-slash"></i>
                            <div>لا يوجد مشرفين مسجلين</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            admins.forEach(admin => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${admin.name}</td>
                    <td>${admin.email}</td>
                    <td>${admin.joinDate}</td>
                    <td class="actions">
                        <button class="action-btn edit-btn"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function saveEvaluationSettings() {
            alert('تم حفظ إعدادات التقييم بنجاح');
        }
        
        function backupDatabase() {
            alert('تم إنشاء نسخة احتياطية بنجاح');
        }
        
        function restoreDatabase() {
            alert('تم استعادة النسخة الاحتياطية بنجاح');
        }
        
        // ===== وظائف مساعدة =====
        function populateGroupsDropdown(dropdownId) {
            const select = document.getElementById(dropdownId);
            select.innerHTML = '<option value="">اختر مجموعة</option>';
            
            groups.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = group.name;
                select.appendChild(option);
            });
        }
        
        function populateStudentsDropdown(dropdownId) {
            const select = document.getElementById(dropdownId);
            select.innerHTML = '<option value="">اختر طالب</option>';
            
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                select.appendChild(option);
            });
        }
        
        function populateAdminsDropdown(dropdownId) {
            const select = document.getElementById(dropdownId);
            select.innerHTML = '<option value="">اختر مشرف</option>';
            
            admins.forEach(admin => {
                const option = document.createElement('option');
                option.value = admin.id;
                option.textContent = admin.name;
                select.appendChild(option);
            });
        }
        
        function populatePartsDropdown() {
            const select = document.getElementById('followup-part');
            select.innerHTML = '<option value="">اختر جزء</option>';
            
            quranParts.forEach((part, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = `الجزء ${index + 1}: ${part}`;
                select.appendChild(option);
            });
        }
        
        function getEvaluationText(evaluation) {
            switch(evaluation) {
                case 'excellent': return 'ممتاز';
                case 'very-good': return 'جيد جداً';
                case 'good': return 'جيد';
                case 'weak': return 'ضعيف';
                default: return 'غير محدد';
            }
        }
        
        function showMessage(elementId, message, type) {
            const messageDiv = document.getElementById(elementId);
            messageDiv.textContent = message;
            messageDiv.className = 'alert';
            messageDiv.classList.add(type === 'success' ? 'alert-success' : 'alert-error');
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
        
        function updateStats() {
            const totalStudents = students.length;
            const excellentStudents = students.filter(s => s.evaluation === 'excellent').length;
            const veryGoodStudents = students.filter(s => s.evaluation === 'very-good').length;
            const needsAttention = totalStudents - excellentStudents - veryGoodStudents;
            
            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('excellent-students').textContent = excellentStudents;
            document.getElementById('verygood-students').textContent = veryGoodStudents;
            document.getElementById('needs-attention').textContent = needsAttention;
        }
        
        function renderTopStudents() {
            const container = document.getElementById('top-students');
            container.innerHTML = '';
            
            const topStudents = [...students]
                .sort((a, b) => {
                    const evalOrder = ['excellent', 'very-good', 'good', 'weak'];
                    return evalOrder.indexOf(a.evaluation) - evalOrder.indexOf(b.evaluation);
                })
                .slice(0, 5);
            
            if (topStudents.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-user-slash"></i> لا توجد بيانات</div>`;
                return;
            }
            
            topStudents.forEach((student, index) => {
                let medal = '';
                if (index === 0) medal = '<span class="medal gold"><i class="fas fa-medal"></i></span>';
                else if (index === 1) medal = '<span class="medal silver"><i class="fas fa-medal"></i></span>';
                else if (index === 2) medal = '<span class="medal bronze"><i class="fas fa-medal"></i></span>';
                
                const item = document.createElement('div');
                item.className = 'followup-item';
                item.innerHTML = `
                    <div>
                        <strong>${student.name} ${medal}</strong>
                        <div>المجموعة: ${student.group}</div>
                        <div>التقييم: ${getEvaluationText(student.evaluation)}</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function createProgressChart() {
            const ctx = document.getElementById('progress-chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر'],
                    datasets: [{
                        label: 'متوسط الصفحات المحفوظة',
                        data: [12, 19, 15, 22, 18, 25, 30, 28, 35, 40],
                        backgroundColor: 'rgba(21, 152, 149, 0.2)',
                        borderColor: 'rgba(21, 152, 149, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(21, 152, 149, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(21, 152, 149, 1)',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'عدد الصفحات'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'الشهر'
                            }
                        }
                    }
                }
            });
        }
        
        function updateUI() {
            renderStudentsTable();
            renderFollowupsHistory();
            renderRecentFollowups();
            renderGroupsList();
            renderAdminsTable();
            renderTopStudents();
            updateStats();
            
            populateGroupsDropdown('student-group');
            populateGroupsDropdown('followup-group');
            populateGroupsDropdown('assign-group');
            populateStudentsDropdown('followup-student');
            populateStudentsDropdown('assign-student');
            populateAdminsDropdown('group-supervisor');
            populatePartsDropdown();
            
            createProgressChart();
        }
        
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // إظهار زر التمرير للأعلى عند التمرير لأسفل
        window.onscroll = function() {
            const btn = document.querySelector('.floating-btn');
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = 'flex';
            } else {
                btn.style.display = 'none';
            }
        };
    </script>
</body>
</html>
